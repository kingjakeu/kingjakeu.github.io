# Kafka 란

카프카란 실시간으로 발생한 데이터를 처리 하는 이벤트 스트리밍 플랫폼이다.
예를 들어, 넷플릭스에서 시청 도중에도 실시간으로 사용자에게 컨텐츠 추천해주거나 우버에서 실시간으로 운행 정보를 모아 금액을 계산해줄 때 사용된다.

## 카프카의 구성

카프카는 데이터를 생산하는 Producer와 데이터를 소비하는 Consumer로 구성되어 있는 Pub/Sub 모델로 구현되어 있다.

Pub/Sub 모델에서 Producer에 메시지를 publish 되고
Consumer는 Subscribe하는 메시지만을 Broker에게 요청하여 가져간다.
즉, 발행시에는 특정 수신인이 없고, 수신자는 자신이 구독한 정보만 가져가는 모델이다.

### Pub/Sub 모델 특징

- Consumer가 불능 상태 더라도, Producer는 메시지를 발행 할 수 있다. 그리고 Consumer는 다시 회복 되었을 때, 해당 메시지를 가져간다.
- 기존의 통신과는 다르게 확장에 용이하다. 예를 들어, 기존에 6개의 Producer와 4개의 Consumer가 있었다면 총 24개의 연결이 필요했다.
하지만 Pub/Sub 모델에서는 중간 브로커에게만 연결하먄 된다.

### 카프카의 특징

카프가는 Pub/Sub 모델의 메시징 시스템이지만 기존 Pub/Sub 모델의 메시징 시스템과 다른 카프카만의 특징이 존재한다.

#### 다중 프로듀서, 다중 컨슈머

하나의 토픽(메시지 구분 단위)에 여러 프로듀서와 여러 컨슈머가 접근 가능하다.
하나의 토픽에 여러 프로듀서가 동시에 메시지를 전송할 수 있으며, 또한 여러 컨슈머가 토픽에 접근하여 메시지를 가져 갈 수 있다.

#### 파일 시스템 저장

기존의 메시징 시스템은 메시지들을 브로커 메모리에 존재하는 큐에 저장하여 처리 했다.
해당 구조에서는 컨슈머가 메시지를 읽어가면 큐에서 pop되어 메시지는 사라진다.
하지만 카프카에서는 메시지를 파일 시스템에 저장, 보존 기간 내에는 컨슈머가 언제든 가져갈 수 있다.

### 확장성

카프카는 운영 중 브로커를 추가할 수 있다. 운영 중 트래픽이 높아질 경우 브로커를 추가하여 클러스터를 확장할 수 있다.
또한 프로듀서와 컨슈머도 필요에 의해 서비스 중단 없이 가능하다.

## 카프카 내부 시스템 구성 요소

### 토픽

프로듀서는 특정 토픽에 메시지를 발행한다. 그리고 컨슈머는 특정 토픽에서 발행되는 메시지를 구독할 수 있다.
프로듀서와 컨슈머는 토픽 기준으로 메시지를 서로 주고 받는다.

### 파티션

카프카 클러스터는 토픽을 세분화된 파티션으로 나눈다. 그리고 나눠진 파티션은 클러스터의 브로커들이 나눠 갖는다.
브로커들은 파티션에 저장된 메시지들을 세그먼트 파일로 만들어 파일 시스템에 저장한다.
보존 기간이 지난 메시지들은 세그먼트 파일 단위로 삭제된다.
